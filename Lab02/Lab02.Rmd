---
title: "Lab02: Análise de Gastos de Deputados"
author: "Hadrizia Santos"
date: "06 de novembro de 2017"
output: html_document
---

Inicialmente carregam-se os dados a serem analisados:
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
library(dplyr)
library(ggplot2)
library(scales)
library(reshape2)
library(readr)
library(gridExtra)
library(plotly)
aqua <- 'rgba(61, 217, 219, 1)'
dadosCEAP <- read_csv("~/Downloads/dadosCEAP.csv")
dadosCEAP$valorGlosa <- as.numeric(sub(",", ".", dadosCEAP$valorGlosa, fixed = TRUE)) 
dadosLimiteCEAP <- read_csv("~/Downloads/limiteMensalCEAP.csv")
colnames(dadosLimiteCEAP)[colnames(dadosLimiteCEAP) == 'UF'] <- 'sgUF'
dadosCEAP <- inner_join(dadosCEAP, dadosLimiteCEAP, "sgUF")

```

```{r eval = FALSE}
library(dplyr)
library(ggplot2)
library(scales)
library(reshape2)
library(readr)
library(gridExtra)
library(plotly)
aqua <- 'rgba(61, 217, 219, 1)'
dadosCEAP <- read_csv("~/Downloads/dadosCEAP.csv")
dadosCEAP$valorGlosa <- as.numeric(sub(",", ".", dadosCEAP$valorGlosa, fixed = TRUE))
dadosLimiteCEAP <- read_csv("~/Downloads/limiteMensalCEAP.csv")
colnames(dadosLimiteCEAP)[colnames(dadosLimiteCEAP) == 'UF'] <- 'sgUF'
dadosCEAP <- inner_join(dadosCEAP, dadosLimiteCEAP, "sgUF")
```

**Pergunta 1: Como estão distribuídas as despesas dos deputados mais gastadores do estado da Paraíba?**
    Acredito que as maiores despesas dos deputados são as passagens de avião e a divulgação do parlamentar, dado que estes possuem valores mais altos quando comparados às outras despesas. As menores despesas seriam com alimentação e serviços postais, por possuírem menor custo.
    Para responder a essa pergunta, precisamos agrupar os deputados do estado da Paraíba e suas despesas, juntamente com o valor total gasto ressarcido pela CEAP. 

```{r}

deputadosPB <- dadosCEAP %>% filter(sgUF=="PB", valorLíquido > 0)

top10DeputadosPB <- deputadosPB %>%
  group_by(nomeParlamentar) %>% 
  summarise(valor = sum(valorLíquido)) %>% arrange(desc(valor)) %>% 
  na.omit() %>% top_n(5)

despesas <- deputadosPB %>% group_by(nomeParlamentar, sgPartido, tipoDespesa) %>% filter(nomeParlamentar %in% top10DeputadosPB$nomeParlamentar) %>%
  summarise(cont = sum(valorLíquido))



despesas %>% plot_ly( x = ~nomeParlamentar,  y=~cont, type = 'bar') %>%
  add_trace(y = ~tipoDespesa, name = 'LA Zoo') %>%
  layout(yaxis = list(title = 'Count'), barmode = 'stack')

plot_ly(despesasDeputadosPB %>% top_n(10), x =~tipoDespesa, y=~valor, group = ~nomeParlamentar, color=~sgPartido) %>% layout(title = "TOP 10 Parlamentares que Excederam Limite Mensal",
          yaxis = list(title = "Parlamentar"),
          xaxis = list(title ="Valor gasto excedido (R$)"))


```


