---
title: "Lab02: Análise de Gastos de Deputados"
author: "Hadrizia Santos"
date: "06 de novembro de 2017"
output: html_document
---

Carregando os dados a serem analisados:
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
library(dplyr)
library(ggplot2)
library(scales)
library(reshape2)
library(readr)
library(gridExtra)
library(plotly)
aqua <- 'rgba(61, 217, 219, 1)'
dadosCEAP <- read_csv("~/Downloads/dadosCEAP.csv")
dadosCEAP$valorGlosa <- as.numeric(sub(",", ".", dadosCEAP$valorGlosa, fixed = TRUE)) 
dadosLimiteCEAP <- read_csv("~/Downloads/limiteMensalCEAP.csv")
colnames(dadosLimiteCEAP)[colnames(dadosLimiteCEAP) == 'UF'] <- 'sgUF'
dadosCEAP <- inner_join(dadosCEAP, dadosLimiteCEAP, "sgUF")

```

```{r eval = FALSE}
#library(dplyr)
#library(ggplot2)
#library(scales)
#library(reshape2)
#library(readr)
#library(gridExtra)
#library(plotly)
aqua <- 'rgba(61, 217, 219, 1)'
dadosCEAP <- read_csv("~/Downloads/dadosCEAP.csv")
dadosCEAP$valorGlosa <- as.numeric(sub(",", ".", dadosCEAP$valorGlosa, fixed = TRUE))
dadosLimiteCEAP <- read_csv("~/Downloads/limiteMensalCEAP.csv")
colnames(dadosLimiteCEAP)[colnames(dadosLimiteCEAP) == 'UF'] <- 'sgUF'
dadosCEAP <- inner_join(dadosCEAP, dadosLimiteCEAP, "sgUF")
```

**Pergunta 1: Como as despesas da CEAP estão distribuídas por partido no estado da Paraíba?**
  Acredito que o partido mais gastador seja o PMDB, pois é o partido que possui mais deputados federais eleitos na Paraíba.

```{r}
deputadosPB <- dadosCEAP %>% 
  group_by(nomeParlamentar, sgUF, sgPartido, valorLíquido, tipoDespesa) %>%
  filter(sgUF == "PB", valorLíquido > 0) %>%
  arrange(desc(valorLíquido)) %>% na.omit() %>% ungroup()
```

```{r}
  gastosPorPartido <- deputadosPB %>% group_by(nomeParlamentar, sgPartido) %>%
    summarise(mediana_valor = median(valorLíquido)) %>%
    ungroup() %>%
    arrange(desc(mediana_valor)) %>% na.omit()

  bp1 <- ggplot(gastosPorPartido, aes(x = reorder(sgPartido, -mediana_valor), y = mediana_valor), fill=sgPartido) +
  geom_boxplot(outlier.colour = "red", outlier.color = "pink") +  xlab("Estado") + ylab("Uso") + ggtitle("Distribuição das despesas por partido na Paraíba") + theme_bw() + ylim(0, 800)
  
  ggplotly(bp1)
```

    Após a análise da distribuição do valor gasto por partido disponível no gráfico acima, percebe-se que o partido **PSDB** possui o deputado mais gastador, pois contém a maior mediana em relação aos outros partidos. 

**Pergunta 2: Como as despesas estão distribuídas entre os parlamentares do estado da Paraíba?**

    Acredito que as maiores despesas da CEAP sejam com passagens aéreas e divulgação da atividade parlamentar, visto que estas são as despesas que possuem maior custo. As menores despesas acredito que sejam com alimentação do deputado e serviços postais, pois se tratam se despesas de menor custo.
    
    
  
```{r}
despesasDeputados <- deputadosPB %>% 
  group_by(nomeParlamentar, tipoDespesa) %>%
  summarise(valor = sum(valorLíquido)) %>% 
  arrange(desc(valor)) %>% na.omit() %>% ungroup()

plot_ly(despesasRomuloGouveia, y =~ valor, x=~reorder(tipoDespesa, valor), color=~tipoDespesa) %>%
   layout(title = "Despesas gastas pelo deputado Rômulo Gouveia",
          xaxis = list(title = "Parlamentar"),
          yaxis = list(title ="Valor gasto (R$)"))
```

 gastosPorDeputado <- deputadosPB %>% group_by(nomeParlamentar, valor, sgPartido) 

  plot_ly(gastosPorDeputado, y =~ valor, x=~reorder(nomeParlamentar, -valor), color=~sgPartido) %>%
   layout(title = "Parlamentares mais gastadores da Paraíba",
          xaxis = list(title = "Parlamentar"),
          yaxis = list(title ="Valor gasto (R$)"))
```

  
**Pergunta 3: Como as despesas do deputado mais gastador estão distribuídas?**
    

```{r}
despesasRomuloGouveia <- dadosCEAP %>% 
  group_by(nomeParlamentar, tipoDespesa) %>%
  summarise(valor = sum(valorLíquido)) %>% 
  filter(nomeParlamentar == "RÔMULO GOUVEIA") %>%
  arrange(desc(valor)) %>% na.omit() %>% ungroup()

plot_ly(despesasRomuloGouveia, y =~ valor, x=~reorder(tipoDespesa, valor), color=~tipoDespesa) %>%
   layout(title = "Despesas gastas pelo deputado Rômulo Gouveia",
          xaxis = list(title = "Parlamentar"),
          yaxis = list(title ="Valor gasto (R$)"))

```


