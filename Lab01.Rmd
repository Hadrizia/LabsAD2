---
title: "Análise de Gastos de Deputados"
author: "Hadrizia Santos"
date: "25 de outubro de 2017"
output: html_document
---

**1. Quais os partidos que mais fazem uso da CEAP? Quais os partidos que menos fazem uso? Mesmas perguntas conisderando valores em R$.**

Para responder a esta pergunta, deve-se inicialmente carregar os dados:
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(scales)
library(reshape2)
library(readr)
library(gridExtra)

```

```{r eval = FALSE}
#library(dplyr)
#library(ggplot2)
#library(scales)
#library(reshape2)
#library(readr)
dadosCEAP <- read_csv("~/Downloads/dadosCEAP.csv")
dadosCEAP$valorGlosa <- as.numeric(sub(",", ".", dadosCEAP$valorGlosa, fixed = TRUE))
```

```{r include = FALSE}
dadosCEAP <- read_csv("~/Downloads/dadosCEAP.csv")
dadosCEAP$valorGlosa <- as.numeric(sub(",", ".", dadosCEAP$valorGlosa, fixed = TRUE)) 
```

  Depois, precisa-se agrupar os deputados de acordo com seus partidos e sumarizar a contagem de uso da CEAP. A seguir, pegam-se os 10 partidos que mais usaram o CEAP e os que menos usaram e exibe-os em dois gráficos de barra horizontal:
  
```{r}
knitr::opts_chunk$set(fig.align = "center", fig.width = 10)
depUsoCEAP <- dadosCEAP %>% group_by(sgPartido) %>% 
  summarise(contUsoCEAP = n(), dinheiroGasto = sum(valorLíquido)) %>% na.omit()
```

```{r}
g1 <- ggplot(depUsoCEAP %>% top_n(10), 
             aes(x = reorder(sgPartido, contUsoCEAP), y = contUsoCEAP)) + geom_bar(stat = "identity", fill = "#2bd6c4") + coord_flip() + 
  xlab("Partidos") +
  ylab("Uso CEAP") +
  ggtitle(ggtitle("Top 10",subtitle = "Partidos que mais usam o CEAP")) +
  theme_bw()

g2 <- ggplot(depUsoCEAP %>% top_n(-10), 
             aes(x = reorder(sgPartido, -contUsoCEAP), y = contUsoCEAP)) + geom_bar(stat = "identity", fill = "#ff6666") + coord_flip() +
   xlab("") +
  theme_bw() + 
  ylab("Uso CEAP") +
  ggtitle("Top 10", subtitle = "Partidos que menos usam o CEAP")

grid.arrange(g1, g2, ncol=2)
```


```{r}

p1 <- ggplot(depUsoCEAP %>% top_n(10), 
         aes(x = reorder(sgPartido, dinheiroGasto), y = dinheiroGasto)) + 
  geom_bar(stat = "identity", fill = "#2bd6c4") + coord_flip() +
  theme_bw() + 
  xlab("Partidos") +
  ylab("Gasto (R$)") +
  ggtitle("Top 10", subtitle = "Partidos que mais fazem uso da CEAP considerando R$")

p2 <- ggplot(depUsoCEAP %>% top_n(-10), 
         aes(x = reorder(sgPartido, -dinheiroGasto), y = dinheiroGasto)) + 
  geom_bar(stat = "identity", fill = "#ff6666") + coord_flip() +
  theme_bw() + 
  xlab("Partidos") +
  ylab("Gasto (R$)") +
  ggtitle("Top 10", subtitle = "Partidos que menos usam CEAP considerando R$")

grid.arrange(p1, p2, ncol=2)

```


**2. Quais os tipos de despesa mais comuns no uso da CEAP? Mesma pergunta considerando valores em R$.**
```{r}
usoTipoDespesa <- dadosCEAP %>% group_by(tipoDespesa) %>%
  summarise(cont = n(), somaValor= sum(valorLíquido)) %>% arrange(desc(cont)) %>%
  na.omit()
```

```{r}
ggplot(usoTipoDespesa, aes(x = reorder(tipoDespesa, cont), y = cont)) +
  geom_bar(stat = "identity") +
  theme_bw() + coord_flip() + scale_x_discrete(labels = abbreviate) +
  xlab("Tipo de Despesa") +
  ylab("Uso") + ggtitle("Tipos de despesas mais comuns com CEAP")
```
```{r}
ggplot(usoTipoDespesa, aes(x = reorder(tipoDespesa, somaValor), y = somaValor)) +
  geom_bar(stat = "identity") +
  theme_bw() + coord_flip() + scale_x_discrete(labels = abbreviate) +
  xlab("Tipo de Despesa") +
  ylab("Valor (R$)") + ggtitle("Tipos de despesas mais comuns com CEAP", subtitle = "Considerando valores em dinheiro.")
```


**3. Levando em conta o estado pelo qual o deputado se elegeu, quais os estados que mais fazem uso da CEAP? Quais os que menos fazem uso? Mesmas perguntas considerando gastos em R$. Por que você acha isso?**

```{r}
usoEstado <- dadosCEAP %>% group_by(sgUF) %>%
  summarise(count = n(), somaValor = sum(valorLíquido)) %>% arrange(desc(count)) %>% na.omit()

ggplot(usoEstado, aes(x = reorder(sgUF, count), y = count)) +
  geom_bar(stat = "identity") + coord_flip() + xlab("Estado") + ylab("Uso")

ggplot(usoEstado, aes(x = reorder(sgUF, somaValor), y = somaValor)) +
  geom_bar(stat = "identity") + coord_flip() + xlab("Estado") + ylab("Valor gasto (R$)")
```
**4. Quais os parlamentares que mais gastam com CEAP e quais os que menos gastam?**
```{r}
usoParlamentar <- dadosCEAP %>% group_by(nomeParlamentar) %>%
  summarise(valorGasto = sum(valorLíquido)) %>% arrange(desc(valorGasto)) %>% na.omit() 

ggplot(usoParlamentar %>% top_n(10), 
       aes(x = reorder(nomeParlamentar, valorGasto), y = valorGasto)) + 
  geom_bar(stat = "identity") + coord_flip() + xlab("Parlamentar") + ylab("Valor gasto (R$)")

ggplot(usoParlamentar %>% top_n(-10), 
       aes(x = reorder(nomeParlamentar, -valorGasto), y = valorGasto)) + 
  geom_bar(stat = "identity") + coord_flip() + xlab("Parlamentar") + ylab("Valor gasto (R$)")
```


**5. Existe correlação entre a quantidade de gastos no exterior e o valor restituído da CEAP?**
```{r}
viagens <- c('Emissão Bilhete Aéreo', 'PASSAGENS AÉREAS', 'PASSAGENS TERRESTRES, MARÍTIMAS OU FLUVIAIS')

despesaExterior <- dadosCEAP %>% 
  filter(tipoDespesa %in% viagens) %>% group_by(idCadastro) %>% summarise(valorGastoExterior = mean(valorLíquido))

despesaCEAP <- dadosCEAP %>% group_by(idCadastro) %>% 
  summarise(valorGastoTotal = mean(valorLíquido))

rel <- inner_join(despesaExterior, despesaCEAP, "idCadastro")

ggplot(rel, aes(x = valorGastoExterior, y = valorGastoTotal)) +
    geom_point(shape = 1) +
    geom_smooth(method = "lm") + 
  labs(title = "Correlação entre gastos", x = "Despesa exterior", y = "Despesa total") + xlim(0, 2000)
```
```{r}
correlacao <- cor(rel$valorGastoExterior, rel$valorGastoTotal)
#[1] 0.3085323: Correlação desprezível
```

